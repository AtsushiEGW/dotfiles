##### basics #####
set -g escape-time 0

# prefix を C-b -> C-g に
set -g prefix C-g
unbind C-b
bind C-g send-prefix

# pane 分割
bind '\' split-window -h
bind '-'  split-window -v

# マウス / 履歴 / キー
set -g mouse on
setw -g mode-keys vi
set -g history-limit 50000
set -g focus-events on

##### terminal & colors #####
# まずは新しめの terminfo（あるなら使う）
set -g default-terminal "tmux-256color"
# 互換のため screen-256color も許容しつつ truecolor 有効化
set -as terminal-overrides ',screen-256color:RGB'
set -as terminal-overrides ',xterm-256color:RGB'
set -as terminal-overrides ',tmux-256color:RGB'
# 古い環境向けの Tc も足しておく（RGB と重複可）
set -ga terminal-overrides ",*256color*:Tc"

##### status line (控えめ) #####
set -g status-interval 2
set -g status-left-length 40
set -g status-right-length 120
set -g status-left  "#[bold]#S #[default]"
set -g status-right "#(whoami) | %Y-%m-%d %H:%M "

##### navigation / resize #####
# Alt + h/j/k/l で pane 移動
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Alt + Shift + h/j/k/l で pane リサイズ
bind -n M-H resize-pane -L 5
bind -n M-J resize-pane -D 3
bind -n M-K resize-pane -U 3
bind -n M-L resize-pane -R 5

# ウィンドウ移動
bind -n M-[ previous-window
bind -n M-] next-window

##### clipboard #####
# システムのクリップボードコマンドを自動検出して変数に
if-shell 'command -v pbcopy >/dev/null 2>&1' 'set -g @clipboard "pbcopy"'
if-shell 'command -v xclip  >/dev/null 2>&1' 'set -g @clipboard "xclip -selection clipboard"'

# copy-mode-vi キーバインド（y / Enter でコピー & 終了）
unbind -T copy-mode-vi Enter
unbind -T copy-mode-vi y
bind   -T copy-mode-vi y      if -F '#{:@clipboard}' \
  'send -X copy-pipe-and-cancel "#{@clipboard}"' \
  'send -X copy-selection-and-cancel'
bind   -T copy-mode-vi Enter  if -F '#{:@clipboard}' \
  'send -X copy-pipe-and-cancel "#{@clipboard}"' \
  'send -X copy-selection-and-cancel'

# 可能なら tmux 自体のクリップボード連携もON
set-option -g set-clipboard on

##### quality of life #####
# 設定リロード
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

# 同期ペイン切替（全 pane 同時入力）
bind y setw synchronize-panes \; display-message "synchronize-panes: #{?pane_synchronized,on,off}"

# ウィンドウ作成時の現在ディレクトリを引き継ぐ
bind c new-window -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"
bind %   split-window -h -c "#{pane_current_path}"

# 1 から番号開始（お好みで）
set -g base-index 1
setw -g pane-base-index 1