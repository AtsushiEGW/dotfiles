===Project Directory Structure:

.
├── bootstrap.sh
├── docker-template
│   ├── .devcontainer
│   │   ├── devcontainer.json
│   │   └── Dockerfile
│   └── docker-compose.yml
├── README.md
├── tmux
│   └── .tmux.conf
├── vscode
│   ├── keybindings.json
│   └── settings.json
└── zsh
    ├── .zshrc
    ├── aliases.zsh
    └── options.zsh

6 directories, 11 files



=== bootstrap.sh:

#!/usr/bin/env sh
# ~/.dotfiles/bootstrap.sh
# 最小権限で安全・再実行可能な初期化。sudo不可環境ではOSパッケージ導入をスキップし、
# dotfiles配置と oh-my-zsh / プラグイン導入のみ行う。

set -eu

log() { printf '%s\n' "$*"; }
warn() { printf 'WARN: %s\n' "$*"; }

DOTFILES="${DOTFILES:-$HOME/.dotfiles}"
ZSH_DIR="$HOME/.oh-my-zsh"
ZSH_CUSTOM="$ZSH_DIR/custom"

OS="$(uname -s 2>/dev/null || echo Unknown)"
DISTRO="linux"
[ "$OS" = "Darwin" ] && DISTRO="macos"

SUDO=""
if command -v sudo >/dev/null 2>&1 && [ "$(id -u)" != "0" ]; then
  SUDO="sudo"
fi

install_pkgs() {
  case "$DISTRO" in
    macos)
      if ! command -v brew >/dev/null 2>&1; then
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
      fi
      brew update
      # 実用度向上のために rg/fd/curl も入れる
      brew install zsh tmux fzf git ripgrep fd curl
      # fzf のキーバインド（再実行安全）
      "$(brew --prefix)/opt/fzf/install" --no-bash --no-fish --key-bindings --completion --no-update-rc 2>/dev/null || true
      ;;
    linux)
      if command -v apt-get >/dev/null 2>&1; then
        if [ -n "$SUDO" ] || [ "$(id -u)" = "0" ]; then
          export DEBIAN_FRONTEND=noninteractive
          $SUDO apt-get update -y
          $SUDO apt-get install -y --no-install-recommends \
            zsh tmux fzf git ca-certificates curl ripgrep fd-find
          # Debian/Ubuntu は fd-find のコマンド名が fdfind なのでエイリアスを用意（存在時のみ）
          if command -v fdfind >/dev/null 2>&1 && [ ! -e "$HOME/.local/bin/fd" ]; then
            mkdir -p "$HOME/.local/bin"
            ln -snf "$(command -v fdfind)" "$HOME/.local/bin/fd"
          fi
        else
          warn "apt-get を実行できないため OS パッケージ導入をスキップします"
        fi
      elif command -v apk >/dev/null 2>&1; then
        if [ -n "$SUDO" ] || [ "$(id -u)" = "0" ]; then
          $SUDO apk add --no-cache zsh tmux fzf git ca-certificates curl ripgrep fd
        else
          warn "apk を実行できないため OS パッケージ導入をスキップします"
        fi
      else
        warn "対応していないパッケージマネージャです（導入スキップ）"
      fi
      ;;
    *)
      warn "未知の OS。パッケージ導入はスキップします"
      ;;
  esac
}

install_omz() {
  if [ ! -d "$ZSH_DIR" ]; then
    log "Installing oh-my-zsh..."
    RUNZSH=no CHSH=no KEEP_ZSHRC=yes \
      sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
  fi
}

install_plugins() {
  mkdir -p "$ZSH_CUSTOM/plugins"
  if [ ! -d "$ZSH_CUSTOM/plugins/zsh-autosuggestions" ]; then
    git clone --depth=1 https://github.com/zsh-users/zsh-autosuggestions "$ZSH_CUSTOM/plugins/zsh-autosuggestions"
  fi
  if [ ! -d "$ZSH_CUSTOM/plugins/zsh-syntax-highlighting" ]; then
    git clone --depth=1 https://github.com/zsh-users/zsh-syntax-highlighting "$ZSH_CUSTOM/plugins/zsh-syntax-highlighting"
  fi
}

link() {
  # usage: link SRC DST   （SRC が存在する時だけ貼る）
  if [ -e "$1" ]; then
    mkdir -p "$(dirname "$2")"
    ln -snf "$1" "$2"
  else
    warn "リンク元が見つかりません: $1 （スキップ）"
  fi
}

link_dotfiles() {
  link "$DOTFILES/zsh/.zshrc"        "$HOME/.zshrc"
  link "$DOTFILES/zsh/aliases.zsh"   "$HOME/.zsh_aliases"
  link "$DOTFILES/zsh/options.zsh"   "$HOME/.zsh_options"
  link "$DOTFILES/tmux/.tmux.conf"   "$HOME/.tmux.conf"
  # $DOTFILES/fzf/fzf.zsh は不要（.zshrc が自動検出読み込み）
}

install_pkgs
install_omz
install_plugins
link_dotfiles

log "Done. 反映するには新しいシェルを開始してください（例: exec zsh）"


=== zsh/aliases.zsh:

# ~/.zsh_aliases

# 可能なら macOS 判定
is_macos() { [[ "$OSTYPE" == darwin* ]]; }

# ls
if is_macos; then
  alias ls='ls -G -F'
  alias ll='ls -alGh'
else
  alias ls='ls --color=auto -F'
  alias ll='ls -alh --color=auto'
fi
alias la='ls -A'

# grep/cat
alias grep='grep --color=auto'

# 安全系（対話シェル向け）
alias cp='cp -i'
alias mv='mv -i'
alias rm='rm -i'

# Git
alias g='git'
alias gs='git status'
alias gst='git status -sb'
alias gco='git checkout'
alias ga='git add -A'
alias gc='git commit'
alias gp='git push'
alias gpl='git pull --rebase'

# tmux
alias ta='tmux attach -t'
alias tn='tmux new -s'
alias tls='tmux ls'

# クリップボード
if is_macos; then
  alias clip='pbcopy'
elif command -v xclip >/dev/null 2>&1; then
  alias clip='xclip -selection clipboard'
fi

# パス移動
alias ..='cd ..'
alias ...='cd ../..'
alias ....='cd ../../..'


=== zsh/options.zsh:

# ~/.zsh_options

# 補完とメニュー
setopt AUTO_MENU AUTO_LIST MENU_COMPLETE
zmodload zsh/complist 2>/dev/null || true
zstyle ':completion:*' squeeze-slashes true
zstyle ':completion:*' special-dirs true
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
zstyle ':completion:*' menu select   # ← 矢印で候補を選べる

# コメント/履歴
setopt INTERACTIVE_COMMENTS
setopt BANG_HIST EXTENDED_HISTORY INC_APPEND_HISTORY SHARE_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST HIST_IGNORE_DUPS HIST_IGNORE_ALL_DUPS HIST_REDUCE_BLANKS HIST_VERIFY
HISTFILE="$HOME/.zsh_history"
HISTSIZE=200000
SAVEHIST=200000


=== zsh/.zshrc:

# ~/.zshrc - oh-my-zsh ベース（シンプル & 高速）
export LANG=${LANG:-en_US.UTF-8}

# 非インタラクティブなら早期終了（CI等で速く）
[[ $- != *i* ]] && return

# Homebrew (Apple Silicon) の PATH を自動付与
if [[ -x /opt/homebrew/bin/brew ]]; then
  eval "$(/opt/homebrew/bin/brew shellenv)"
fi

# PATH（ユーザ系を少し前に）
typeset -U path PATH
path=(
  $HOME/.local/bin
  $path
)
export PATH

# oh-my-zsh 本体
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="gnzh"   # 等幅でも崩れにくいシンプルなテーマ

# プラグイン（syntax-highlighting は最後にすること！）
plugins=(
  git
  fzf
  zsh-autosuggestions
  zsh-syntax-highlighting
)

source "$ZSH/oh-my-zsh.sh"

# 追加オプション／エイリアス（分割読み込み）
[ -f "$HOME/.zsh_options" ]  && source "$HOME/.zsh_options"
[ -f "$HOME/.zsh_aliases" ]  && source "$HOME/.zsh_aliases"

# autosuggestions の挙動（履歴優先で軽快）
export ZSH_AUTOSUGGEST_STRATEGY=history
export ZSH_AUTOSUGGEST_HISTORY_IGNORE="?(#c50,)"   # 長すぎるコマンドは提案しない(任意)

# fzf：検索ソースの自動選択（rg > fd > find）
if (( $+commands[rg] )); then
  export FZF_DEFAULT_COMMAND='rg --files --hidden --follow --glob "!.git"'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
elif (( $+commands[fd] )); then
  export FZF_DEFAULT_COMMAND='fd --hidden --follow --exclude .git'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
else
  export FZF_DEFAULT_COMMAND='find . -type f -not -path "*/.git/*"'
  export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
fi
# 見やすいUI。--inline-info は古いので --info=inline を使う
export FZF_DEFAULT_OPTS='--height 40% --reverse --border --info=inline --cycle'

# fzf キーバインド/補完（環境に合わせて自動）
if [[ -f "/usr/share/doc/fzf/examples/key-bindings.zsh" ]]; then
  source /usr/share/doc/fzf/examples/key-bindings.zsh
elif [[ -f "/usr/share/fzf/key-bindings.zsh" ]]; then
  source /usr/share/fzf/key-bindings.zsh
elif command -v brew >/dev/null 2>&1 && [[ -f "$(brew --prefix)/opt/fzf/shell/key-bindings.zsh" ]]; then
  source "$(brew --prefix)/opt/fzf/shell/key-bindings.zsh"
elif [[ -f "$HOME/.fzf.zsh" ]]; then
  source "$HOME/.fzf.zsh"
fi

# 補足：oh-my-zsh の fzf plugin は存在チェック目的。上の key-bindings で十分。